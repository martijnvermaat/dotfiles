#!/bin/sh

# Synchronize some data on my external USB disk with local data
#
# To run periodically from a scheduler like cron, for example:
#
#   $ crontab -l
#   # Synchronize USB disk
#   30 03 * * * ~/bin/sync-usb >> /var/log/sync-usb 2>&1
#
# Copyright (c) 2007, Martijn Vermaat

MOUNT_DIR=/media/usb-linux
BACKUP_DIR=$(/bin/date '+%Y-%m')

echo
echo "$(/bin/date)   Starting synchronizing USB disk"

# Test if USB disk is mounted
if ! /bin/grep -q $MOUNT_DIR /etc/mtab; then
    echo "$(/bin/date)   Nothing to do (not connected)"
    exit 1
fi

# Synchronize SVN backup
/usr/bin/rsync -a --delete /backup/svn/ /media/usb-linux/backup/subversion

# Synchronize priscilla backup
/usr/bin/rsync -a --delete /backup/priscilla/ /media/usb-linux/backup/priscilla/automated/$BACKUP_DIR

# Synchronize music collection
/usr/bin/rsync -a --delete /home/martijn/music/ /media/usb-linux/music

echo "$(/bin/date)   Finished synchronizing USB disk"
